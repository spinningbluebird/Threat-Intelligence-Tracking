On July 28, 2020 cyber security researchers at Intezer released a findings report for new backdoor malware "Doki" that is infecting Docker containers in cloud platforms with the Ngrok Mining Botnet. While Ngrok botnet is not new, the technique employed by Doki is: using the blackchain wallet Dogecoin to generate command-and-control domain names. The new malware, Doki, provides a persistent capability for code-execution on the victim host.

The attackers first look for misconfigured Docker API ports. Once they find publicly accessible Docker servers they create their own Docker image using public images from Docker Hub. They take the image they created and then perform a create API request. The body of this request contains configuration parameters for the containers, one of which being "bind". This parameter lets the user configure which file or directory on the host machine to mount into a container. In this attack,  the container is configured to bind the /tmpXXXXXX directory to the root directory of the hosting server which then allows a Docker escape.

At this point attackers use Ngrok to "craft unique URLs with a short lifetime and uses them to download payloads during the attack by passing them to the curl-based image", as stated by the researchers. Of the payloads downloaded includes the Doki payload. Again, Doki is a backdoor which allows execution of code. It is used in the attack to contact its command and control domain using the Dogecoin blockchain by spinning off its own process and then performing queries to dogechain.info API. After contacting the API, the malware hashes the blockchain's response to use as a subdomain. The name of the hash is appended with "ddns.net".

In order to mitigate this threat, Intezer recommends Docker admins check for any exposed ports and to verify there are no foreign or unknown containers among the existing ones. Intezer further recommends monitoring of resources to ensure no excessive use.
